<?php
/**
 * Created by PhpStorm.
 * User: jerry
 * Date: 2018/8/30
 * Time: 15:22
 */

namespace hiione\library;

class MyRedis extends \Redis
{
    protected $redis;
    protected static $config;
    protected static $_instance;

    public function __construct($config)
    {
        self::$config = $config;
        $this->connect($config['redis_host'], $config['redis_port']);
        if (!empty($config['redis_auth'])) {
            $this->auth($config['redis_auth']);
        }
        $this->select($config['redis_db']);
        self::$_instance = $this;
    }

    public function get($key, $prefix = true)
    {
        $key = ($prefix ? self::$config['redis_prefix'] . $key : $key);
        return json_decode(parent::get($key), true); // TODO: Change the autogenerated stub
    }

    public function set($key, $value, $prefix = true, $timeout = 0)
    {
        $key = ($prefix ? self::$config['redis_prefix'] . $key : $key);
        return parent::set($key, json_encode($value)); // TODO: Change the autogenerated stub
    }

    public function del($keys)
    {
        $num = 0;
        if (is_array($keys)) {
            foreach ($keys as $v) {
                $t = parent::del(self::$config['redis_prefix'] . $v);
                if ($t) {
                    $num++;
                }
            }
        } else {
            $num = parent::del(self::$config['redis_prefix'] . $keys);
        }
        return $num;
    }

    public static function setPrefix($prefix)
    {
        self::$config['redis_prefix'] = $prefix;
    }

    public static function getInstance()
    {
        return self::$_instance;
    }
}